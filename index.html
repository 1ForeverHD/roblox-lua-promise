<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Roblox Lua Promise | Roblox Lua Promise</title>
    <meta name="description" content="Promise implementation for Roblox">
    
    
    <link rel="preload" href="/roblox-lua-promise/assets/css/0.styles.d877d60a.css" as="style"><link rel="preload" href="/roblox-lua-promise/assets/js/app.c5a63d93.js" as="script"><link rel="preload" href="/roblox-lua-promise/assets/js/6.27a40301.js" as="script"><link rel="preload" href="/roblox-lua-promise/assets/js/11.6fd8a969.js" as="script"><link rel="prefetch" href="/roblox-lua-promise/assets/js/1.6cd63ced.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/10.0a086da3.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/12.e9c1eb89.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/13.28ca54d4.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/14.cdb6c934.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/15.82ad1f69.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/16.713d0745.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/17.592e56eb.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/18.0f95b66e.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/19.87476339.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/2.47a83fe0.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/20.b789e9a2.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/21.750430af.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/22.89f2c322.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/3.72cb5171.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/5.3082b837.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/7.9b6f8f5c.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/8.30d1d3de.js"><link rel="prefetch" href="/roblox-lua-promise/assets/js/9.1a586211.js">
    <link rel="stylesheet" href="/roblox-lua-promise/assets/css/0.styles.d877d60a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/roblox-lua-promise/" class="home-link router-link-exact-active router-link-active"><!----> <span class="site-name">Roblox Lua Promise</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/roblox-lua-promise/lib/" class="nav-link">API Reference</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/roblox-lua-promise/lib/" class="nav-link">API Reference</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/roblox-lua-promise/lib/" class="sidebar-link">Promise</a></li><li><a href="/roblox-lua-promise/lib/Details.html" class="sidebar-link">Implementation Details</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="roblox-lua-promise"><a href="#roblox-lua-promise" aria-hidden="true" class="header-anchor">#</a> Roblox Lua Promise</h1> <p>An implementation of <code>Promise</code> similar to Promise/A+.</p> <h2 id="motivation"><a href="#motivation" aria-hidden="true" class="header-anchor">#</a> Motivation</h2> <p>The way Roblox models asynchronous operations by default is by yielding (stopping) the thread and then resuming it when the future value is available. This model is not ideal because:</p> <ul><li>Functions you call can yield without warning, or only yield sometimes, leading to unpredictable and surprising results. Accidentally yielding the thread is the source of a large class of bugs and race conditions that Roblox developers run into.</li> <li>It is difficult to deal with running multiple asynchronous operations concurrently and then retrieve all of their values at the end without extraneous machinery.</li> <li>When an asynchronous operation fails or an error is encountered, Lua functions usually either raise an error or return a success value followed by the actual value. Both of these methods lead to repeating the same tired patterns many times over for checking if the operation was successful.</li> <li>Yielding lacks easy access to introspection and the ability to cancel an operation if the value is no longer needed.</li></ul> <h3 id="goals"><a href="#goals" aria-hidden="true" class="header-anchor">#</a> Goals</h3> <p>This Promise implementation attempts to satisfy these traits:</p> <ul><li>An object that represents a unit of asynchronous work</li> <li>Composability</li> <li>Predictable timing</li></ul> <h2 id="example"><a href="#example" aria-hidden="true" class="header-anchor">#</a> Example</h2> <p>This Promise implementation finished synchronously. In order to wrap an existing async API, you should use <code>spawn</code> or <code>delay</code> in order to prevent your calling thread from accidentally yielding.</p> <div class="language-lua extra-class"><pre class="language-lua"><code><span class="token keyword">local</span> HttpService <span class="token operator">=</span> game<span class="token punctuation">:</span><span class="token function">GetService</span><span class="token punctuation">(</span><span class="token string">&quot;HttpService&quot;</span><span class="token punctuation">)</span>

<span class="token comment">-- A light wrapper around HttpService</span>
<span class="token comment">-- Ideally, you do this once per project per async method that you use.</span>
<span class="token keyword">local</span> <span class="token keyword">function</span> <span class="token function">httpGet</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
	<span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
		Promise<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">local</span> ok<span class="token punctuation">,</span> result <span class="token operator">=</span> <span class="token function">pcall</span><span class="token punctuation">(</span>HttpService<span class="token punctuation">.</span>GetAsync<span class="token punctuation">,</span> HttpService<span class="token punctuation">,</span> url<span class="token punctuation">)</span>

			<span class="token keyword">if</span> ok <span class="token keyword">then</span>
				<span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
			<span class="token keyword">else</span>
				<span class="token function">reject</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
			<span class="token keyword">end</span>
		<span class="token keyword">end</span><span class="token punctuation">)</span>
	<span class="token keyword">end</span><span class="token punctuation">)</span>
<span class="token keyword">end</span>

<span class="token comment">-- Usage</span>
<span class="token function">httpGet</span><span class="token punctuation">(</span><span class="token string">&quot;https://google.com&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">:</span><span class="token function">andThen</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>
		<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;Here's the Google homepage:&quot;</span><span class="token punctuation">,</span> body<span class="token punctuation">)</span>
	<span class="token keyword">end</span><span class="token punctuation">)</span>
	<span class="token punctuation">:</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;We failed to get the Google homepage!&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token keyword">end</span><span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/roblox-lua-promise/assets/js/app.c5a63d93.js" defer></script><script src="/roblox-lua-promise/assets/js/6.27a40301.js" defer></script><script src="/roblox-lua-promise/assets/js/11.6fd8a969.js" defer></script>
  </body>
</html>
